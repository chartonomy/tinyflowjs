{"version":3,"file":"Tinyflow.es5.js","sources":["../lib/Tinyflow.js"],"sourcesContent":["/**\n * Tinyflow is a minimalistic workflow engine with\n * easy customization.\n * You can use it with any JavaScript runtime as it\n * makes no use of any runtime-specifics.\n * @type {object}\n */\nexport const Tinyflow = {}\n\n// ----------------------------------------------------------------------------\n// Internal Variables\n// ----------------------------------------------------------------------------\nconst _ = {\n  /**\n   * All registered extensions\n   */\n  extensions: new Map(),\n  /**\n   * Contains all created, non-disposed instances\n   */\n  instances: new Map(),\n  /**\n   * The default id generation. You obviously want to use the {Tinyflow.extend} method to bring your own\n   * @private\n   */\n  id: () => Math.random().toString(16).substring(2, 16),\n  /**\n   * Listeners are mapped by emitters\n   * in WeakMap in order to have GC remove them,\n   * if the emitter is cleared\n   * @private\n   * @type {WeakMap<object, any>}\n   */\n  listeners: new WeakMap()\n}\n\n// make available as local variables\n// without the need for the _. prefix\nconst { extensions, listeners, instances } = _\n\n/**\n * Get the listeners for a given emitter.\n * Always returns an array.\n *\n * @private\n * @param emitter {Emitter}\n * @param name {string }\n * @returns {function[]}\n */\nlisteners.by = (emitter, name) => {\n  if (!listeners.has(emitter)) {\n    listeners.set(emitter, new Map())\n  }\n  return listeners.get(emitter).get(name) || []\n}\n\n// ----------------------------------------------------------------------------\n// Public API\n// ----------------------------------------------------------------------------\n/**\n * Extend Tinyflow functionality. In contrast to register an extension this\n * method allows to extend Tinyflows core functionality.\n * @param fn\n */\nTinyflow.extend = fn => fn(_)\n\n/**\n * Gets a workflow instance by its id\n * @method\n * @param id {string}\n * @returns {Workflow}\n */\nTinyflow.get = id => instances.get(id)\n\n/**\n * Returns all non-disposed workflows of any state.\n * @method\n * @return {Workflow[]}\n */\nTinyflow.all = () => [...instances.values()]\n\n/**\n * Clears all extensions and instances. By default, all engines are shut down\n * and fire the end event.\n * @method\n * @param options {object=} options\n * @param options.extensions {boolean=} signal to clear all extensions\n */\nTinyflow.clear = (options = {}) => {\n  const ids = [...instances.keys()]\n  for (const instanceId of ids) {\n    const workflow = Tinyflow.get(instanceId)\n    workflow.cancel()\n    Tinyflow.dispose(instanceId)\n  }\n  if (options.extensions) {\n    extensions.clear()\n  }\n}\n\n/**\n * Register an extension by name. Extensions run on workflow-properties that\n * are not part of the engine core.\n * Core properties are currently: id, next, name, prev\n *\n * Extensions can be registered for workflows and/or steps, which can be determined by\n * the second parameter of their callback.\n *\n * Callbacks can also be async, but they're not awaited (only caught).\n * If callback is null then the extension will be removed.\n *\n * @param name {string} name of the property to register an extension\n * @param handler {null|function(property, context):Promise|void} callback to execute\n */\nTinyflow.use = (name, handler) => {\n  const fn = handler === null ? extensions.delete : extensions.set\n  fn.call(extensions, name, handler)\n}\n\n/**\n * Creates a new workflow instance by given workflow definitions.\n *\n * @param definition {object} the workflow definitions object\n * @returns {Workflow}\n */\nTinyflow.create = (definition) => {\n  const workflow = new Workflow(definition)\n  instances.set(workflow.id, workflow)\n  return workflow\n}\n\n/**\n * Fully disposes a workflow, including any event listener\n * to it, or its current step.\n * Once complete it will finally remove the workflow from\n * the internal instances list.\n * @param instanceId {string}\n * @param force {boolean=}\n */\nTinyflow.dispose = (instanceId, { force = false } = {}) => {\n  const workflow = instances.get(instanceId)\n  if (!workflow) {\n    throw new TinyflowError(`Workflow does not exist by id ${instanceId}`)\n  }\n  if (!force && workflow.state === 'active') {\n    throw new TinyflowError(`Cannot dispose active workflow \"${workflow.name}\"`, { instanceId })\n  }\n  if (workflow.current) {\n    workflow.current.off()\n    workflow.current = null\n  }\n  workflow.off()\n  listeners.delete(workflow)\n  instances.delete(instanceId)\n}\n\n// ----------------------------------------------------------------------------\n// Internal Implementations\n// ----------------------------------------------------------------------------\nconst tick = (fn, t = 0) => setTimeout(fn, t)\nconst promisify = (fn, args) => new Promise((res, rej) => {\n  try {\n    res(fn(...args))\n  } catch (e) {\n    rej(e)\n  }\n})\n\n/**\n * @class\n * A tiny emitter that provides just the bare minimum.\n */\nclass Emitter {\n  /**\n   * returns the size\n   * @return {number}\n   */\n  count () {\n    return listeners.by(this, name).length\n  }\n\n  /**\n   * Attach a new listener\n   * @param name {string}\n   * @param fn {function}\n   */\n  on (name, fn) {\n    let list = listeners.by(this, name)\n    list.push(fn)\n    listeners.get(this).set(name, list)\n  }\n\n  once (name, fn) {\n    fn.once = true\n    this.on(name, fn)\n  }\n\n  /**\n   * Remove listeners. Has multiple combinations:\n   * - if no arg at all is passed will remove **everything**\n   * - if only name is passed will remove all listeners by name\n   * - if name and function is passed will remove only this specific\n   *   listener, if it has been attached before\n   * @param name {string=}\n   * @param fn {function=}\n   */\n  off (name, fn) {\n    if (!name) {\n      listeners.get(this).clear()\n      return // exit\n    }\n    let list = listeners.by(this, name)\n    if (!fn) {\n      list.length = 0\n    }\n    let index = list.length > 0 && list.findIndex((f) => f === fn)\n    if (index > -1) {\n      list.splice(index, 1)\n    } else {\n      throw new TinyflowError(`No listener found by function for event ${name}`, {\n        id: this.id,\n        name: this.name\n      })\n    }\n    listeners.get(this).set(name, list)\n  }\n\n  /**\n   * Fires a new single event for this emitter.\n   * If a listener was registered with the \"once\" flag\n   * then it will only be fired once, then removed\n   * from the listeners list.\n   *\n   * Additional data can be added by an exact single second\n   * argument. Use an object if you have complex data to\n   * submit during the event.\n   * @param name {string} name of the event\n   * @param data {any=} optional data\n   */\n  emit (name, data) {\n    const list = listeners.by(this, name).reverse()\n    for (let i = list.length - 1; i >= 0; i--) {\n      const f = list[i]\n      tick(() => {\n        promisify(f, [data])\n          .catch(e => this.emit('error', { error: e, source: this }))\n      })\n      if (f.once) {\n        list.splice(i, 1)\n      }\n    }\n    listeners.get(this).set(name, list)\n  }\n}\n\n/**\n * A minimal Error extension to add\n * details\n * @class\n */\nclass TinyflowError extends Error {\n  constructor (message, details) {\n    super(message)\n    this.name = 'TinyflowError'\n    this.details = details\n  }\n}\n\nconst runExtensions = ({ workflow, step, onSuccess, onError }) => {\n  const target = workflow || step\n  Promise.all(Object\n      .keys(target.custom)\n      .filter(key => extensions.has(key))\n      .map(name => {\n        const fn = extensions.get(name)\n        const value = target.custom[name]\n        return fn(value, { workflow, step })\n      }))\n    .then(onSuccess)\n    .catch(onError)\n}\n\n/**\n * The main workflow execution class,\n * defined by the given definitions file.\n *\n * Initial state is pending, until `start()` is called.\n * Hooks will not run when pending.\n *\n * Next step is defined either by `next` being defined in the current step\n * or by user explicitly set the name or index of the step.\n * It's up to you to handle permissions for any of these methods.\n *\n * Emits various events, see the respective method documentation.\n *\n * @class\n * @see {Tinyflow.create}\n */\nexport class Workflow extends Emitter {\n\n  /**\n   * Creates a new instance. Any properties in the definitions, hat are not\n   * one of name, id or steps are considered \"custom\" and are (optionally) handled\n   * by their respective extensions (if registered).\n   *\n   * @constructor\n   * @param name {string} name of the workflow\n   * @param id {string} identifier of this instance of the workflow (in case you run multiple of the same)\n   * @param steps {object} the workflows step definitions\n   * @param custom {object} contains all custom properties of this workflow's definitions\n   * @see {Tinyflow.use}\n   * @throws {TinyflowError} if steps are not defined or have length of 0\n   */\n  constructor ({ name, id, steps = {}, ...custom }) {\n    super()\n    this.name = name\n    this.id = id || _.id()\n    this.data = null\n    this.state = 'pending'\n    this.custom = {}\n    this.history = []\n\n    // parse extensions\n    const stepExt = {}\n    Object.entries(custom).forEach(([key, val]) => {\n      // if extensions are not defined as array, we\n      // assume them to run in global scope\n      const [fn, scope] = Array.isArray(val) ? val : [val, 'all']\n\n      // attach extensions for workflows directly\n      if (['all', 'workflow'].includes(scope)) {\n        this.custom[key] = fn\n      }\n      // attach extensions for steps to temp object,\n      // so we can use them in the step parsing\n      // note, that if a step defines the extensions as null\n      // then it will prevent this extension for this step\n      if (['all', 'steps'].includes(scope)) {\n        stepExt[key] = fn\n      }\n    })\n\n    this.steps = Object\n      .entries(steps)\n      .map(([name, value], index, array) => {\n        const next = index < array.length - 1\n          ? index + 1\n          : null\n        return { next, name, ...stepExt, ...value }\n      })\n\n    if (this.steps.length === 0) {\n      throw new TinyflowError(\n        'Workflow steps must have at least one entry, got 0',\n        { name, id }\n      )\n    }\n\n    /**\n     * The current step\n     * @type {Step|null}\n     */\n    this.current = null\n  }\n\n  /**\n   * Starts the workflow, runs through all extensions.\n   * Extensions are caught in a separate Microtask (Promise.catch) and will\n   * not cause the workflow start to cancel.\n   * Sets thw workflow state to \"active\"\n   * @emits started - when the workflow instance has successfully started (state became 'active')\n   * @param {autoStep=} if set to false it will not automatically step into the first available step\n   * @throws {TinyflowError} if the state is other than \"pending\"\n   */\n  start ({ autoStep } = {}) {\n    if (this.state === 'active') {\n      throw new TinyflowError(\n        `Cannot start active workflow`,\n        { name: this.name, id: this.id }\n      )\n    }\n    this.data = Object.create(null)\n    const workflow = this\n\n    runExtensions({\n      workflow,\n      onSuccess: () => {\n        this.state = 'active'\n        this.emit('started', this)\n        if (autoStep !== false) {\n          this.step(0)\n        }\n      },\n      onError: e => this.emit('error', { error: e, workflow })\n    })\n  }\n\n  /**\n   * Sets a given step by name or index as the new current one.\n   * This method is for manually setting the next step.\n   * If you want the engine to automatically set the next step you\n   * should rather end the current step using step.complete or step.cancel\n   *\n   * When a new step is set, the current step will be disposed properly,\n   * so you don't have to do it.\n   *\n   * Will listen to the new step's \"end\" event and automatically\n   * determine the next step to choose or to end the workflow.\n   *\n   * @param indexOrName {string|number|null} index of the step in linear flows or name of the step in non-linear flows\n   * @param options {object=}\n   * @param options.stepId {string=} an optional\n   * @param options.autoOnEnd {boolean=} set to true to prevent workflow from automatically handling the next step\n   *   if the current step ends\n   * @emits step - when the new step is properly set up and active\n   * @throws {TinyflowError} if no step is found by index or name\n   */\n  step (indexOrName, { stepId, autoOnEnd } = {}) {\n    if (this.state !== 'active') {\n      throw new TinyflowError(\n        `Can only step in an active state, got \"${this.state}\"`,\n        { indexOrName, name: this.name, id: this.id }\n      )\n    }\n\n    let stepDef = typeof indexOrName === 'number'\n      ? this.steps[indexOrName]\n      : this.steps.find(({ name }) => name === indexOrName)\n\n    if (!stepDef) {\n      throw new TinyflowError(\n        `Expected step definition, got ${stepDef}`,\n        { indexOrName, name: this.name, id: this.id }\n      )\n    }\n\n    const id = stepId || _.id()\n    const workflowId = this.id\n    const step = new Step({ id, workflowId, ...stepDef })\n    const workflow = this\n    const endStep = (step) => {\n      if (step) {\n        step.off()\n        // for a most simple audit we save a minimal set of data\n        // that allows for reproduction or implementing a \"back to previous\"\n        // procedure, for example using extensions or other externals\n        this.history.push({ name: step.name, data: { ...step.data }, at: new Date() })\n      }\n      return true\n    }\n\n    if (autoOnEnd !== false) {\n      step.once('end', (step) => {\n        workflow.data[step.name] = { ...step.data }\n\n        const next = step.next\n        return (next !== null && next <= workflow.steps.length - 1)\n          ? tick(() => workflow.step(next))\n          : endStep(step) && workflow.complete()\n      })\n    }\n\n    step.start()\n    endStep(this.current)\n    this.current = step\n    this.emit('step', this)\n  }\n\n  /**\n   * Completes the workflow, sets the current step to null\n   * and the state to \"complete\".\n   * Does not delete the workflow data as opposed to the cancel event\n   * @emits end - the workflow has ended, see the state property for in which state it ended\n   */\n  complete () {\n    if (this.current) {\n      this.current.off()\n    }\n    this.current = null\n    this.state = 'complete'\n    this.emit('end', this)\n  }\n\n  /**\n   *\n   *Completes the workflow but also wiped it's data\n   * and sets state as \"cancelled\"\n   * @emits end - the workflow has ended, see the state property for in which state it ended\n   */\n  cancel () {\n    if (this.current) {\n      this.current.off()\n    }\n    this.data = null\n    this.current = null\n    this.state = 'complete'\n    this.emit('end', this)\n  }\n}\n\n/**\n * Represents an executable unit of a workflow.\n * Steps work best when they are atomically related to exactly one\n * task. It is up to the user to define and implement what such\n * a task might be.\n * Examples of tasks can be fetching data from an endpoint or\n * users submitting a form.\n * Just make sure a step does not involve multiple tasks.\n * @class\n */\nexport class Step extends Emitter {\n  /**\n   * Creates a new step instance\n   * @constructor\n   * @param id {string}\n   * @param workflowId {string}\n   * @param name {string}\n   * @param data {object=} optional data from start of the workflow\n   * @param next {string|number|undefined}\n   * @param custom {...object} all other properties that will be passed on to your custom handlers\n   */\n  constructor ({ id, workflowId, name, data = null, next, ...custom }) {\n    super()\n    this.id = id || _.id()\n    this.workflowId = workflowId\n    this.name = name\n    this.next = next\n    this.custom = custom\n    this.state = 'pending'\n    this.data = data\n  }\n\n  /**\n   * Starts the step, changing its state from 'pending' to active.\n   *\n   * Note: This method is usually called by the workflow automatically. You\n   * should by default not have the need to call this method.\n   *\n   * Runs through all extensions.\n   *\n   * Extensions are caught in a separate Microtask (Promise.catch) and will\n   * not cause the step-start to cancel.\n   *\n   * @emits started - when the step instance has successfully started (state became 'active')\n   * @throws {TinyflowError} if the current state is other than \"pending\"\n   */\n  start () {\n    if (this.state === 'active') {\n      throw new TinyflowError(\n        `Cannot start a step in active state`,\n        { name: this.name, id: this.id, wf: this.workflowId }\n      )\n    }\n\n    this.data = this.data || Object.create(null)\n    const step = this\n\n    runExtensions({\n      step,\n      onSuccess: () => {\n        this.state = 'active'\n        this.emit('started', this)\n      },\n      onError: e => this.emit('error', { error: e, step })\n    })\n  }\n\n  /**\n   * Updates the step's data (hard-override!)\n   * Use it's existing data to merge\n   * @example\n   * step.update({ foo: 1 }) // { foo: 1}\n   * step.update({ bar: 2, ...step.data }) // { foo: 1, bar: 2 }\n   * @param data {object}\n   * @emits update - the step's data has updated\n   */\n  update (data) {\n    this.data = Object.create(null)\n    Object.assign(this.data, data)\n    this.emit('update', this)\n  }\n\n  /**\n   * Sets the workflow state to 'complete'\n   * @emits end - the workflow has ended, see state for the way it ended\n   */\n  complete () {\n    this.state = 'complete'\n    this.emit('end', this)\n  }\n\n  /**\n   * Sets the workflow state to 'cancelled' and wipes the data\n   * @emits end - the workflow has ended, see state for the way it ended\n   */\n  cancel () {\n    this.state = 'cancelled'\n    this.data = null\n    this.emit('end', this)\n  }\n}\n\n"],"names":["Tinyflow","_","extensions","Map","instances","id","Math","random","toString","substring","listeners","WeakMap","by","emitter","name","has","set","get","extend","fn","all","_toConsumableArray","values","clear","options","arguments","length","undefined","ids","keys","_iterator","_createForOfIteratorHelper","_step","s","n","done","instanceId","value","workflow","cancel","dispose","err","e","f","use","handler","call","create","definition","Workflow","_ref","_ref$force","force","TinyflowError","concat","state","current","off","tick","t","setTimeout","promisify","args","Promise","res","rej","apply","Emitter","_classCallCheck","_createClass","key","count","on","list","push","once","index","findIndex","splice","emit","data","_this","reverse","_loop","i","error","source","_Error","_inherits","_super","_createSuper","message","details","_this2","_wrapNativeSuper","Error","runExtensions","_ref2","step","onSuccess","onError","target","Object","custom","filter","map","then","_Emitter","_super2","_ref3","_this3","_ref3$steps","steps","_objectWithoutProperties","_excluded","history","stepExt","entries","forEach","_ref4","_ref5","_slicedToArray","val","_ref6","Array","isArray","_ref7","scope","includes","_ref8","array","_ref9","next","_objectSpread","start","_this4","_ref10","autoStep","indexOrName","_this5","_ref11","stepId","autoOnEnd","stepDef","find","_ref12","workflowId","Step","endStep","at","Date","complete","_Emitter2","_super3","_ref13","_this6","_ref13$data","_excluded2","_this7","wf","update","assign"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACY,IAACA,QAAQ,GAAG,CAAE,CAAA;;AAE1B;AACA;AACA;AACA,IAAMC,CAAC,GAAG;EACV;AACA;AACA;EACEC,UAAU,EAAE,IAAIC,GAAG,CAAE,CAAA;EACvB;AACA;AACA;EACEC,SAAS,EAAE,IAAID,GAAG,CAAE,CAAA;EACtB;AACA;AACA;AACA;EACEE,EAAE,EAAE,SAAAA,GAAA;IAAA,OAAMC,IAAI,CAACC,MAAM,EAAE,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC;EAAA;EACvD;AACA;AACA;AACA;AACA;AACA;AACA;EACEC,SAAS,EAAE,IAAIC,OAAO,CAAE;AAC1B,CAAC;;AAED;AACA;AACA,IAAQT,UAAU,GAA2BD,CAAC,CAAtCC,UAAU;EAAEQ,SAAS,GAAgBT,CAAC,CAA1BS,SAAS;EAAEN,SAAS,GAAKH,CAAC,CAAfG,SAAS;;AAExC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAM,SAAS,CAACE,EAAE,GAAG,UAACC,OAAO,EAAEC,IAAI,EAAK;EAChC,IAAI,CAACJ,SAAS,CAACK,GAAG,CAACF,OAAO,CAAC,EAAE;IAC3BH,SAAS,CAACM,GAAG,CAACH,OAAO,EAAE,IAAIV,GAAG,CAAA,CAAE,CAAC;EAClC;EACD,OAAOO,SAAS,CAACO,GAAG,CAACJ,OAAO,CAAC,CAACI,GAAG,CAACH,IAAI,CAAC,IAAI,EAAE;AAC/C,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAd,QAAQ,CAACkB,MAAM,GAAG,UAAAC,EAAE;EAAA,OAAIA,EAAE,CAAClB,CAAC,CAAC;AAAA;;AAE7B;AACA;AACA;AACA;AACA;AACA;AACAD,QAAQ,CAACiB,GAAG,GAAG,UAAAZ,EAAE;EAAA,OAAID,SAAS,CAACa,GAAG,CAACZ,EAAE,CAAC;AAAA;;AAEtC;AACA;AACA;AACA;AACA;AACAL,QAAQ,CAACoB,GAAG,GAAG;EAAA,OAAAC,kBAAA,CAAUjB,SAAS,CAACkB,MAAM,CAAA,CAAE;AAAA,CAAC;;AAE5C;AACA;AACA;AACA;AACA;AACA;AACA;AACAtB,QAAQ,CAACuB,KAAK,GAAG,YAAkB;EAAA,IAAjBC,OAAO,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,EAAE;EAC5B,IAAMG,GAAG,GAAAP,kBAAA,CAAOjB,SAAS,CAACyB,IAAI,CAAA,CAAE,CAAC;EAAA,IAAAC,SAAA,GAAAC,0BAAA,CACRH,GAAG;IAAAI,KAAA;EAAA;IAA5B,KAAAF,SAAA,CAAAG,CAAA,MAAAD,KAAA,GAAAF,SAAA,CAAAI,CAAA,IAAAC,IAAA,GAA8B;MAAA,IAAnBC,UAAU,GAAAJ,KAAA,CAAAK,KAAA;MACnB,IAAMC,QAAQ,GAAGtC,QAAQ,CAACiB,GAAG,CAACmB,UAAU,CAAC;MACzCE,QAAQ,CAACC,MAAM,CAAE,CAAA;MACjBvC,QAAQ,CAACwC,OAAO,CAACJ,UAAU,CAAC;IAC7B;EAAA,SAAAK,GAAA;IAAAX,SAAA,CAAAY,CAAA,CAAAD,GAAA;EAAA;IAAAX,SAAA,CAAAa,CAAA;EAAA;EACD,IAAInB,OAAO,CAACtB,UAAU,EAAE;IACtBA,UAAU,CAACqB,KAAK,CAAE,CAAA;EACnB;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAvB,QAAQ,CAAC4C,GAAG,GAAG,UAAC9B,IAAI,EAAE+B,OAAO,EAAK;EAChC,IAAM1B,EAAE,GAAG0B,OAAO,KAAK,IAAI,GAAG3C,UAAU,UAAO,GAAGA,UAAU,CAACc,GAAG;EAChEG,EAAE,CAAC2B,IAAI,CAAC5C,UAAU,EAAEY,IAAI,EAAE+B,OAAO,CAAC;AACpC,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA7C,QAAQ,CAAC+C,MAAM,GAAG,UAACC,UAAU,EAAK;EAChC,IAAMV,QAAQ,GAAG,IAAIW,QAAQ,CAACD,UAAU,CAAC;EACzC5C,SAAS,CAACY,GAAG,CAACsB,QAAQ,CAACjC,EAAE,EAAEiC,QAAQ,CAAC;EACpC,OAAOA,QAAQ;AACjB,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAtC,QAAQ,CAACwC,OAAO,GAAG,UAACJ,UAAU,EAA6B;EAAA,IAAAc,IAAA,GAAAzB,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAP,EAAE;IAAA0B,UAAA,GAAAD,IAAA,CAApBE,KAAK;IAALA,KAAK,GAAAD,UAAA,cAAG,KAAK,GAAAA,UAAA;EAC7C,IAAMb,QAAQ,GAAGlC,SAAS,CAACa,GAAG,CAACmB,UAAU,CAAC;EAC1C,IAAI,CAACE,QAAQ,EAAE;IACb,MAAM,IAAIe,aAAa,kCAAAC,MAAA,CAAkClB,UAAU,CAAE,CAAC;EACvE;EACD,IAAI,CAACgB,KAAK,IAAId,QAAQ,CAACiB,KAAK,KAAK,QAAQ,EAAE;IACzC,MAAM,IAAIF,aAAa,qCAAAC,MAAA,CAAoChB,QAAQ,CAACxB,IAAI,SAAK;MAAEsB,UAAU,EAAVA;KAAY,CAAC;EAC7F;EACD,IAAIE,QAAQ,CAACkB,OAAO,EAAE;IACpBlB,QAAQ,CAACkB,OAAO,CAACC,GAAG,CAAE,CAAA;IACtBnB,QAAQ,CAACkB,OAAO,GAAG,IAAI;EACxB;EACDlB,QAAQ,CAACmB,GAAG,CAAE,CAAA;EACd/C,SAAS,UAAO,CAAC4B,QAAQ,CAAC;EAC1BlC,SAAS,UAAO,CAACgC,UAAU,CAAC;AAC9B,CAAC;;AAED;AACA;AACA;AACA,IAAMsB,IAAI,GAAG,SAAPA,IAAIA,CAAIvC,EAAE;EAAA,IAAEwC,CAAC,GAAAlC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC;EAAA,OAAKmC,UAAU,CAACzC,EAAE,EAAEwC,CAAC,CAAC;AAAA;AAC7C,IAAME,SAAS,GAAG,SAAZA,SAASA,CAAI1C,EAAE,EAAE2C,IAAI;EAAA,OAAK,IAAIC,OAAO,CAAC,UAACC,GAAG,EAAEC,GAAG,EAAK;IACxD,IAAI;MACFD,GAAG,CAAC7C,EAAE,CAAA+C,KAAA,SAAA7C,kBAAA,CAAIyC,IAAI,EAAC,CAAC;IACjB,CAAA,CAAC,OAAOpB,CAAC,EAAE;MACVuB,GAAG,CAACvB,CAAC,CAAC;IACP;EACH,CAAC,CAAC;AAAA;;AAEF;AACA;AACA;AACA;AAHA,IAIMyB,OAAO;EAAA,SAAAA,QAAA;IAAAC,eAAA,OAAAD,OAAA;EAAA;EAAAE,YAAA,CAAAF,OAAA;IAAAG,GAAA;IAAAjC,KAAA;IACb;AACA;AACA;AACA;IACE,SAAAkC,MAAA,EAAS;MACP,OAAO7D,SAAS,CAACE,EAAE,CAAC,IAAI,EAAEE,IAAI,CAAC,CAACY,MAAM;IACvC;;IAEH;AACA;AACA;AACA;AACA;EAJA;IAAA4C,GAAA;IAAAjC,KAAA,EAKE,SAAAmC,GAAI1D,IAAI,EAAEK,EAAE,EAAE;MACZ,IAAIsD,IAAI,GAAG/D,SAAS,CAACE,EAAE,CAAC,IAAI,EAAEE,IAAI,CAAC;MACnC2D,IAAI,CAACC,IAAI,CAACvD,EAAE,CAAC;MACbT,SAAS,CAACO,GAAG,CAAC,IAAI,CAAC,CAACD,GAAG,CAACF,IAAI,EAAE2D,IAAI,CAAC;IACpC;EAAA;IAAAH,GAAA;IAAAjC,KAAA,EAED,SAAAsC,KAAM7D,IAAI,EAAEK,EAAE,EAAE;MACdA,EAAE,CAACwD,IAAI,GAAG,IAAI;MACd,IAAI,CAACH,EAAE,CAAC1D,IAAI,EAAEK,EAAE,CAAC;IAClB;;IAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EARA;IAAAmD,GAAA;IAAAjC,KAAA,EASE,SAAAoB,IAAK3C,IAAI,EAAEK,EAAE,EAAE;MACb,IAAI,CAACL,IAAI,EAAE;QACTJ,SAAS,CAACO,GAAG,CAAC,IAAI,CAAC,CAACM,KAAK,CAAE,CAAA;QAC3B,OAAM,CAAA;MACP;;MACD,IAAIkD,IAAI,GAAG/D,SAAS,CAACE,EAAE,CAAC,IAAI,EAAEE,IAAI,CAAC;MACnC,IAAI,CAACK,EAAE,EAAE;QACPsD,IAAI,CAAC/C,MAAM,GAAG,CAAC;MAChB;MACD,IAAIkD,KAAK,GAAGH,IAAI,CAAC/C,MAAM,GAAG,CAAC,IAAI+C,IAAI,CAACI,SAAS,CAAC,UAAClC,CAAC;QAAA,OAAKA,CAAC,KAAKxB,EAAE;MAAA,EAAC;MAC9D,IAAIyD,KAAK,GAAG,CAAC,CAAC,EAAE;QACdH,IAAI,CAACK,MAAM,CAACF,KAAK,EAAE,CAAC,CAAC;MAC3B,CAAK,MAAM;QACL,MAAM,IAAIvB,aAAa,4CAAAC,MAAA,CAA4CxC,IAAI,GAAI;UACzET,EAAE,EAAE,IAAI,CAACA,EAAE;UACXS,IAAI,EAAE,IAAI,CAACA;QACnB,CAAO,CAAC;MACH;MACDJ,SAAS,CAACO,GAAG,CAAC,IAAI,CAAC,CAACD,GAAG,CAACF,IAAI,EAAE2D,IAAI,CAAC;IACpC;;IAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAXA;IAAAH,GAAA;IAAAjC,KAAA,EAYE,SAAA0C,KAAMjE,IAAI,EAAEkE,IAAI,EAAE;MAAA,IAAAC,KAAA;MAChB,IAAMR,IAAI,GAAG/D,SAAS,CAACE,EAAE,CAAC,IAAI,EAAEE,IAAI,CAAC,CAACoE,OAAO,CAAE,CAAA;MAAA,IAAAC,KAAA,YAAAA,MAAA,EACJ;QACzC,IAAMxC,CAAC,GAAG8B,IAAI,CAACW,CAAC,CAAC;QACjB1B,IAAI,CAAC,YAAM;UACTG,SAAS,CAAClB,CAAC,EAAE,CAACqC,IAAI,CAAC,CAAC,SACZ,CAAC,UAAAtC,CAAC;YAAA,OAAIuC,KAAI,CAACF,IAAI,CAAC,OAAO,EAAE;cAAEM,KAAK,EAAE3C,CAAC;cAAE4C,MAAM,EAAEL;YAAI,CAAE,CAAC;UAAA,EAAC;QACrE,CAAO,CAAC;QACF,IAAItC,CAAC,CAACgC,IAAI,EAAE;UACVF,IAAI,CAACK,MAAM,CAACM,CAAC,EAAE,CAAC,CAAC;QAClB;MACF,CAAA;MATD,KAAK,IAAIA,CAAC,GAAGX,IAAI,CAAC/C,MAAM,GAAG,CAAC,EAAE0D,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE;QAAAD,KAAA;MAAA;MAUzCzE,SAAS,CAACO,GAAG,CAAC,IAAI,CAAC,CAACD,GAAG,CAACF,IAAI,EAAE2D,IAAI,CAAC;IACpC;EAAA;EAAA,OAAAN,OAAA;AAAA;AAGH;AACA;AACA;AACA;AACA;AAJA,IAKMd,aAAa,0BAAAkC,MAAA;EAAAC,SAAA,CAAAnC,aAAA,EAAAkC,MAAA;EAAA,IAAAE,MAAA,GAAAC,YAAA,CAAArC,aAAA;EACjB,SAAAA,cAAasC,OAAO,EAAEC,OAAO,EAAE;IAAA,IAAAC,MAAA;IAAAzB,eAAA,OAAAf,aAAA;IAC7BwC,MAAA,GAAAJ,MAAA,CAAA3C,IAAA,OAAM6C,OAAO;IACbE,MAAA,CAAK/E,IAAI,GAAG,eAAe;IAC3B+E,MAAA,CAAKD,OAAO,GAAGA,OAAO;IAAA,OAAAC,MAAA;EACvB;EAAA,OAAAxB,YAAA,CAAAhB,aAAA;AAAA,gBAAAyC,gBAAA,CALyBC,KAAK;AAQjC,IAAMC,aAAa,GAAG,SAAhBA,aAAaA,CAAAC,KAAA,EAA+C;EAAA,IAAzC3D,QAAQ,GAAA2D,KAAA,CAAR3D,QAAQ;IAAE4D,IAAI,GAAAD,KAAA,CAAJC,IAAI;IAAEC,SAAS,GAAAF,KAAA,CAATE,SAAS;IAAEC,OAAO,GAAAH,KAAA,CAAPG,OAAO;EACzD,IAAMC,MAAM,GAAG/D,QAAQ,IAAI4D,IAAI;EAC/BnC,OAAO,CAAC3C,GAAG,CAACkF,MAAM,CACbzE,IAAI,CAACwE,MAAM,CAACE,MAAM,CAAC,CACnBC,MAAM,CAAC,UAAAlC,GAAG;IAAA,OAAIpE,UAAU,CAACa,GAAG,CAACuD,GAAG,CAAC;EAAA,EAAC,CAClCmC,GAAG,CAAC,UAAA3F,IAAI,EAAI;IACX,IAAMK,EAAE,GAAGjB,UAAU,CAACe,GAAG,CAACH,IAAI,CAAC;IAC/B,IAAMuB,KAAK,GAAGgE,MAAM,CAACE,MAAM,CAACzF,IAAI,CAAC;IACjC,OAAOK,EAAE,CAACkB,KAAK,EAAE;MAAEC,QAAQ,EAARA,QAAQ;MAAE4D,IAAI,EAAJA;IAAI,CAAE,CAAC;EAC5C,CAAO,CAAC,CAAC,CACJQ,IAAI,CAACP,SAAS,CAAC,SACV,CAACC,OAAO,CAAC;AACnB,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA,IAgBanD,QAAQ,0BAAA0D,QAAA;EAAAnB,SAAA,CAAAvC,QAAA,EAAA0D,QAAA;EAAA,IAAAC,OAAA,GAAAlB,YAAA,CAAAzC,QAAA;EAErB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,SAAAA,SAAA4D,KAAA,EAAkD;IAAA,IAAAC,MAAA;IAAA,IAAnChG,IAAI,GAAA+F,KAAA,CAAJ/F,IAAI;MAAET,EAAE,GAAAwG,KAAA,CAAFxG,EAAE;MAAA0G,WAAA,GAAAF,KAAA,CAAEG,KAAK;MAALA,KAAK,GAAAD,WAAA,cAAG,CAAE,CAAA,GAAAA,WAAA;MAAKR,MAAM,GAAAU,wBAAA,CAAAJ,KAAA,EAAAK,SAAA;IAAA9C,eAAA,OAAAnB,QAAA;IAC5C6D,MAAA,GAAAF,OAAA,CAAA9D,IAAA;IACAgE,MAAA,CAAKhG,IAAI,GAAGA,IAAI;IAChBgG,MAAA,CAAKzG,EAAE,GAAGA,EAAE,IAAIJ,CAAC,CAACI,EAAE,CAAE,CAAA;IACtByG,MAAA,CAAK9B,IAAI,GAAG,IAAI;IAChB8B,MAAA,CAAKvD,KAAK,GAAG,SAAS;IACtBuD,MAAA,CAAKP,MAAM,GAAG,CAAE,CAAA;IAChBO,MAAA,CAAKK,OAAO,GAAG,EAAE;;IAErB;IACI,IAAMC,OAAO,GAAG,CAAE,CAAA;IAClBd,MAAM,CAACe,OAAO,CAACd,MAAM,CAAC,CAACe,OAAO,CAAC,UAAAC,KAAA,EAAgB;MAAA,IAAAC,KAAA,GAAAC,cAAA,CAAAF,KAAA;QAAdjD,GAAG,GAAAkD,KAAA;QAAEE,GAAG,GAAAF,KAAA;MAC7C;MACA;MACM,IAAAG,KAAA,GAAoBC,KAAK,CAACC,OAAO,CAACH,GAAG,CAAC,GAAGA,GAAG,GAAG,CAACA,GAAG,EAAE,KAAK,CAAC;QAAAI,KAAA,GAAAL,cAAA,CAAAE,KAAA;QAApDxG,EAAE,GAAA2G,KAAA;QAAEC,KAAK,GAAAD,KAAA;;MAEtB;MACM,IAAI,CAAC,KAAK,EAAE,UAAU,CAAC,CAACE,QAAQ,CAACD,KAAK,CAAC,EAAE;QACvCjB,MAAA,CAAKP,MAAM,CAACjC,GAAG,CAAC,GAAGnD,EAAE;MACtB;MACP;MACA;MACA;MACA;MACM,IAAI,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC6G,QAAQ,CAACD,KAAK,CAAC,EAAE;QACpCX,OAAO,CAAC9C,GAAG,CAAC,GAAGnD,EAAE;MAClB;IACP,CAAK,CAAC;IAEF2F,MAAA,CAAKE,KAAK,GAAGV,MAAM,CAChBe,OAAO,CAACL,KAAK,CAAC,CACdP,GAAG,CAAC,UAAAwB,KAAA,EAAgBrD,KAAK,EAAEsD,KAAK,EAAK;MAAA,IAAAC,KAAA,GAAAV,cAAA,CAAAQ,KAAA;QAA/BnH,IAAI,GAAAqH,KAAA;QAAE9F,KAAK,GAAA8F,KAAA;MAChB,IAAMC,IAAI,GAAGxD,KAAK,GAAGsD,KAAK,CAACxG,MAAM,GAAG,CAAC,GACjCkD,KAAK,GAAG,CAAC,GACT,IAAI;MACR,OAAAyD,aAAA,CAAAA,aAAA;QAASD,IAAI,EAAJA,IAAI;QAAEtH,IAAI,EAAJA;MAAI,GAAKsG,OAAO,GAAK/E,KAAK;IACjD,CAAO,CAAC;IAEJ,IAAIyE,MAAA,CAAKE,KAAK,CAACtF,MAAM,KAAK,CAAC,EAAE;MAC3B,MAAM,IAAI2B,aAAa,CACrB,oDAAoD,EACpD;QAAEvC,IAAI,EAAJA,IAAI;QAAET,EAAE,EAAFA;MAAI,CACb,CAAA;IACF;;IAEL;AACA;AACA;AACA;IACIyG,MAAA,CAAKtD,OAAO,GAAG,IAAI;IAAA,OAAAsD,MAAA;EACpB;;EAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EARAzC,YAAA,CAAApB,QAAA;IAAAqB,GAAA;IAAAjC,KAAA,EASE,SAAAiG,MAAA,EAA0B;MAAA,IAAAC,MAAA;MAAA,IAAAC,MAAA,GAAA/G,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAJ,EAAE;QAAfgH,QAAQ,GAAAD,MAAA,CAARC,QAAQ;MACf,IAAI,IAAI,CAAClF,KAAK,KAAK,QAAQ,EAAE;QAC3B,MAAM,IAAIF,aAAa,iCAErB;UAAEvC,IAAI,EAAE,IAAI,CAACA,IAAI;UAAET,EAAE,EAAE,IAAI,CAACA;QAAI,CACjC,CAAA;MACF;MACD,IAAI,CAAC2E,IAAI,GAAGsB,MAAM,CAACvD,MAAM,CAAC,IAAI,CAAC;MAC/B,IAAMT,QAAQ,GAAG,IAAI;MAErB0D,aAAa,CAAC;QACZ1D,QAAQ,EAARA,QAAQ;QACR6D,SAAS,EAAE,SAAAA,UAAA,EAAM;UACfoC,MAAI,CAAChF,KAAK,GAAG,QAAQ;UACrBgF,MAAI,CAACxD,IAAI,CAAC,SAAS,EAAEwD,MAAI,CAAC;UAC1B,IAAIE,QAAQ,KAAK,KAAK,EAAE;YACtBF,MAAI,CAACrC,IAAI,CAAC,CAAC,CAAC;UACb;QACF,CAAA;QACDE,OAAO,EAAE,SAAAA,QAAA1D,CAAC;UAAA,OAAI6F,MAAI,CAACxD,IAAI,CAAC,OAAO,EAAE;YAAEM,KAAK,EAAE3C,CAAC;YAAEJ,QAAQ,EAARA;WAAU,CAAC;QAAA;MAC9D,CAAK,CAAC;IACH;;IAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAnBA;IAAAgC,GAAA;IAAAjC,KAAA,EAoBE,SAAA6D,KAAMwC,WAAW,EAA8B;MAAA,IAAAC,MAAA;MAAA,IAAAC,MAAA,GAAAnH,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAJ,CAAA,CAAE;QAAxBoH,MAAM,GAAAD,MAAA,CAANC,MAAM;QAAEC,SAAS,GAAAF,MAAA,CAATE,SAAS;MACpC,IAAI,IAAI,CAACvF,KAAK,KAAK,QAAQ,EAAE;QAC3B,MAAM,IAAIF,aAAa,4CAAAC,MAAA,CACqB,IAAI,CAACC,KAAK,SACpD;UAAEmF,WAAW,EAAXA,WAAW;UAAE5H,IAAI,EAAE,IAAI,CAACA,IAAI;UAAET,EAAE,EAAE,IAAI,CAACA;QAAI,CAC9C,CAAA;MACF;MAED,IAAI0I,OAAO,GAAG,OAAOL,WAAW,KAAK,QAAQ,GACzC,IAAI,CAAC1B,KAAK,CAAC0B,WAAW,CAAC,GACvB,IAAI,CAAC1B,KAAK,CAACgC,IAAI,CAAC,UAAAC,MAAA;QAAA,IAAGnI,IAAI,GAAAmI,MAAA,CAAJnI,IAAI;QAAA,OAAOA,IAAI,KAAK4H,WAAW;MAAA,EAAC;MAEvD,IAAI,CAACK,OAAO,EAAE;QACZ,MAAM,IAAI1F,aAAa,kCAAAC,MAAA,CACYyF,OAAO,GACxC;UAAEL,WAAW,EAAXA,WAAW;UAAE5H,IAAI,EAAE,IAAI,CAACA,IAAI;UAAET,EAAE,EAAE,IAAI,CAACA;QAAI,CAC9C,CAAA;MACF;MAED,IAAMA,EAAE,GAAGwI,MAAM,IAAI5I,CAAC,CAACI,EAAE,CAAE,CAAA;MAC3B,IAAM6I,UAAU,GAAG,IAAI,CAAC7I,EAAE;MAC1B,IAAM6F,IAAI,GAAG,IAAIiD,IAAI,CAAAd,aAAA;QAAGhI,EAAE,EAAFA,EAAE;QAAE6I,UAAU,EAAVA;MAAU,GAAKH,OAAO,CAAE,CAAC;MACrD,IAAMzG,QAAQ,GAAG,IAAI;MACrB,IAAM8G,OAAO,GAAG,SAAVA,OAAOA,CAAIlD,IAAI,EAAK;QACxB,IAAIA,IAAI,EAAE;UACRA,IAAI,CAACzC,GAAG,CAAE,CAAA;UAClB;UACA;UACA;UACQkF,MAAI,CAACxB,OAAO,CAACzC,IAAI,CAAC;YAAE5D,IAAI,EAAEoF,IAAI,CAACpF,IAAI;YAAEkE,IAAI,EAAAqD,aAAA,KAAOnC,IAAI,CAAClB,IAAI,CAAE;YAAEqE,EAAE,EAAE,IAAIC,IAAI,CAAE;UAAA,CAAE,CAAC;QAC/E;QACD,OAAO,IAAI;MACZ,CAAA;MAED,IAAIR,SAAS,KAAK,KAAK,EAAE;QACvB5C,IAAI,CAACvB,IAAI,CAAC,KAAK,EAAE,UAACuB,IAAI,EAAK;UACzB5D,QAAQ,CAAC0C,IAAI,CAACkB,IAAI,CAACpF,IAAI,CAAC,GAAAuH,aAAA,KAAQnC,IAAI,CAAClB,IAAI,CAAE;UAE3C,IAAMoD,IAAI,GAAGlC,IAAI,CAACkC,IAAI;UACtB,OAAQA,IAAI,KAAK,IAAI,IAAIA,IAAI,IAAI9F,QAAQ,CAAC0E,KAAK,CAACtF,MAAM,GAAG,CAAC,GACtDgC,IAAI,CAAC;YAAA,OAAMpB,QAAQ,CAAC4D,IAAI,CAACkC,IAAI,CAAC;UAAA,EAAC,GAC/BgB,OAAO,CAAClD,IAAI,CAAC,IAAI5D,QAAQ,CAACiH,QAAQ,CAAE,CAAA;QAChD,CAAO,CAAC;MACH;MAEDrD,IAAI,CAACoC,KAAK,CAAE,CAAA;MACZc,OAAO,CAAC,IAAI,CAAC5F,OAAO,CAAC;MACrB,IAAI,CAACA,OAAO,GAAG0C,IAAI;MACnB,IAAI,CAACnB,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC;IACxB;;IAEH;AACA;AACA;AACA;AACA;AACA;EALA;IAAAT,GAAA;IAAAjC,KAAA,EAME,SAAAkH,SAAA,EAAY;MACV,IAAI,IAAI,CAAC/F,OAAO,EAAE;QAChB,IAAI,CAACA,OAAO,CAACC,GAAG,CAAE,CAAA;MACnB;MACD,IAAI,CAACD,OAAO,GAAG,IAAI;MACnB,IAAI,CAACD,KAAK,GAAG,UAAU;MACvB,IAAI,CAACwB,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC;IACvB;;IAEH;AACA;AACA;AACA;AACA;AACA;EALA;IAAAT,GAAA;IAAAjC,KAAA,EAME,SAAAE,OAAA,EAAU;MACR,IAAI,IAAI,CAACiB,OAAO,EAAE;QAChB,IAAI,CAACA,OAAO,CAACC,GAAG,CAAE,CAAA;MACnB;MACD,IAAI,CAACuB,IAAI,GAAG,IAAI;MAChB,IAAI,CAACxB,OAAO,GAAG,IAAI;MACnB,IAAI,CAACD,KAAK,GAAG,UAAU;MACvB,IAAI,CAACwB,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC;IACvB;EAAA;EAAA,OAAA9B,QAAA;AAAA,EAvM2BkB,OAAO;AA0MrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA,IAUagF,IAAI,0BAAAK,SAAA;EAAAhE,SAAA,CAAA2D,IAAA,EAAAK,SAAA;EAAA,IAAAC,OAAA,GAAA/D,YAAA,CAAAyD,IAAA;EACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,SAAAA,KAAAO,MAAA,EAAqE;IAAA,IAAAC,MAAA;IAAA,IAAtDtJ,EAAE,GAAAqJ,MAAA,CAAFrJ,EAAE;MAAE6I,UAAU,GAAAQ,MAAA,CAAVR,UAAU;MAAEpI,IAAI,GAAA4I,MAAA,CAAJ5I,IAAI;MAAA8I,WAAA,GAAAF,MAAA,CAAE1E,IAAI;MAAJA,IAAI,GAAA4E,WAAA,cAAG,IAAI,GAAAA,WAAA;MAAExB,IAAI,GAAAsB,MAAA,CAAJtB,IAAI;MAAK7B,MAAM,GAAAU,wBAAA,CAAAyC,MAAA,EAAAG,UAAA;IAAAzF,eAAA,OAAA+E,IAAA;IAC/DQ,MAAA,GAAAF,OAAA,CAAA3G,IAAA;IACA6G,MAAA,CAAKtJ,EAAE,GAAGA,EAAE,IAAIJ,CAAC,CAACI,EAAE,CAAE,CAAA;IACtBsJ,MAAA,CAAKT,UAAU,GAAGA,UAAU;IAC5BS,MAAA,CAAK7I,IAAI,GAAGA,IAAI;IAChB6I,MAAA,CAAKvB,IAAI,GAAGA,IAAI;IAChBuB,MAAA,CAAKpD,MAAM,GAAGA,MAAM;IACpBoD,MAAA,CAAKpG,KAAK,GAAG,SAAS;IACtBoG,MAAA,CAAK3E,IAAI,GAAGA,IAAI;IAAA,OAAA2E,MAAA;EACjB;;EAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EAbAtF,YAAA,CAAA8E,IAAA;IAAA7E,GAAA;IAAAjC,KAAA,EAcE,SAAAiG,MAAA,EAAS;MAAA,IAAAwB,MAAA;MACP,IAAI,IAAI,CAACvG,KAAK,KAAK,QAAQ,EAAE;QAC3B,MAAM,IAAIF,aAAa,wCAErB;UAAEvC,IAAI,EAAE,IAAI,CAACA,IAAI;UAAET,EAAE,EAAE,IAAI,CAACA,EAAE;UAAE0J,EAAE,EAAE,IAAI,CAACb;QAAY,CACtD,CAAA;MACF;MAED,IAAI,CAAClE,IAAI,GAAG,IAAI,CAACA,IAAI,IAAIsB,MAAM,CAACvD,MAAM,CAAC,IAAI,CAAC;MAC5C,IAAMmD,IAAI,GAAG,IAAI;MAEjBF,aAAa,CAAC;QACZE,IAAI,EAAJA,IAAI;QACJC,SAAS,EAAE,SAAAA,UAAA,EAAM;UACf2D,MAAI,CAACvG,KAAK,GAAG,QAAQ;UACrBuG,MAAI,CAAC/E,IAAI,CAAC,SAAS,EAAE+E,MAAI,CAAC;QAC3B,CAAA;QACD1D,OAAO,EAAE,SAAAA,QAAA1D,CAAC;UAAA,OAAIoH,MAAI,CAAC/E,IAAI,CAAC,OAAO,EAAE;YAAEM,KAAK,EAAE3C,CAAC;YAAEwD,IAAI,EAAJA;WAAM,CAAC;QAAA;MAC1D,CAAK,CAAC;IACH;;IAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EARA;IAAA5B,GAAA;IAAAjC,KAAA,EASE,SAAA2H,OAAQhF,IAAI,EAAE;MACZ,IAAI,CAACA,IAAI,GAAGsB,MAAM,CAACvD,MAAM,CAAC,IAAI,CAAC;MAC/BuD,MAAM,CAAC2D,MAAM,CAAC,IAAI,CAACjF,IAAI,EAAEA,IAAI,CAAC;MAC9B,IAAI,CAACD,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC;IAC1B;;IAEH;AACA;AACA;AACA;EAHA;IAAAT,GAAA;IAAAjC,KAAA,EAIE,SAAAkH,SAAA,EAAY;MACV,IAAI,CAAChG,KAAK,GAAG,UAAU;MACvB,IAAI,CAACwB,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC;IACvB;;IAEH;AACA;AACA;AACA;EAHA;IAAAT,GAAA;IAAAjC,KAAA,EAIE,SAAAE,OAAA,EAAU;MACR,IAAI,CAACgB,KAAK,GAAG,WAAW;MACxB,IAAI,CAACyB,IAAI,GAAG,IAAI;MAChB,IAAI,CAACD,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC;IACvB;EAAA;EAAA,OAAAoE,IAAA;AAAA,EAzFuBhF,OAAO;"}